<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="MyInfoMapper">

<select id="myInfo" resultType="MemberVO">
SELECT M.ID, U.NAME, U.BIRTH, U.EMAIL, U.PHONE, U.JOB, R.ROLE
FROM MEMBER M
INNER JOIN USER_INFO U ON M.ID=U.ID
INNER JOIN ROLE R ON M.ID=R.ID
WHERE M.ID=#{id}
</select>

<select id="passwordCheck" resultType="String">
SELECT PWD FROM MEMBER WHERE ID=#{id}
</select>

<select id="modify" resultType="MemberVO">
SELECT M.ID, U.NAME, U.BIRTH, U.GENDER, U.PHONE, U.EMAIL, U.ADDRESS, R.ROLE
FROM MEMBER M
INNER JOIN USER_INFO U ON M.ID=U.ID
INNER JOIN ROLE R ON M.ID=R.ID
WHERE M.ID=#{id}
</select>

<update id="updateMember">
UPDATE MEMBER SET PWD=#{pwd} WHERE ID=#{id}
</update>

<update id="updateUser_info">
UPDATE USER_INFO SET NAME=#{name}, JOB=#{job}, PHONE=CONCAT(#{phone1},'-',#{phone2},'-',#{phone3}), EMAIL=#{email}, ADDRESS=#{address}, HANDICAP=#{handicap} WHERE ID=#{id}
</update>

<delete id="deleteMember">
DELETE FROM MEMBER WHERE ID=#{id}
</delete>

<delete id="deleteUser_info">
DELETE FROM USER_INFO WHERE ID=#{id}
</delete>

<delete id="deleteRole">
DELETE FROM ROLE WHERE ID=#{id}
</delete>

<select id="currentRent" resultType="MyInfoVO">
SELECT R.RENT_DATE, R.SUBMIT_DATE, R.CHECK_SUBMIT, R.CHECK_LATE, B.BTITLE, DATEDIFF(CURDATE(),R.SUBMIT_DATE) AS LATE
FROM RENT_BOOK R
INNER JOIN BOOK B ON R.BNO=B.BNO
WHERE R.ID=#{id}
</select>

<select id="reserveBook" resultType="MyInfoVO">
SELECT RE.RESERVE_DATE, RE.RESERVE_END, RB.SUBMIT_DATE, B.BTITLE, RM.BRENT
FROM RESERVE_BOOK RE
INNER JOIN BOOK B ON RE.BNO=B.BNO 
INNER JOIN RENT_BOOK RB ON RE.BNO=RB.BNO 
INNER JOIN ROOM_B RM ON RE.BNO=RM.BNO
WHERE RE.ID=#{id}
</select>

<select id="rent" resultType="Rent_BookVO">
SELECT R.BNO, R.RENT_DATE, R.SUBMIT_DATE, B.BTITLE
FROM RENT_BOOK R
INNER JOIN BOOK B ON R.BNO=B.BNO
WHERE R.ID=#{id}
</select>

<select id="hope" resultType="HopeVO">
SELECT BNAME, BWRITER, BCOMPANY, BYEAR, HOPE_DATE, RESULT
FROM HOPE_BOOK
WHERE ID=#{id}
</select>

<select id="culture" resultType="MyInfoVO">
SELECT C.CSELECT, C.TITLE, C.MAX_CNT, C.TOCNT, L.CULTURE_DATE, L.STATE
FROM CULTURE C
INNER JOIN CULTURE_LIST L ON C.NUM=L.ANUM
WHERE L.ID=#{id}
</select>

<select id="after" resultType="MyInfoVO">
SELECT A.ASELECT, A.TITLE, A.MAX_CNT, A.TOCNT, L.AFTER_DATE, L.STATE
FROM AFTER A
INNER JOIN AFTER_LIST L ON A.NUM=L.ANUM
WHERE L.ID=#{id}
</select>

</mapper>